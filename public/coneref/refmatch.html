<html>
  <head>
	  <title>Pattern Matching - Cone Reference</title>
		<meta content="text/html; charset=UTF-8" http-equiv="content-type">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
	  <link rel="stylesheet" type="text/css" href="standard.css" />
	</head>
  <body>
		<div id="header">
			<a href="/"><div id="title">Cone</div></a>
			<div id="sub">Pattern Matching</div>
		</div>

    <div class="text">

	<p>As with <span class="pre">if</span>, pattern matching is about deciding
	which code path to perform. 
	Its approach is to match a single value against a multiple patterns.
	When some pattern matches, the code block associated with that pattern is performed.</p>
	<p>Let's illustrate this with a simple (but mathematically bizarre) example:</p>
<pre>
fn power(n i32, pow i32) i32
  match pow
    0: 1
    1: n
    2: n * n
    _: -1
</pre>
	<p>In this example, we are returning a different value based on the value of pow.
	So, if pow is zero, we return 1. If pow is 1, we return n.
	If pow is two, we return n squared. 
	Finally, if pow is any other value, we return -1.</p>
	<p>The structure of this form of pattern matching is straightforward:</p>
	<ul>
	<li>Any normal expression can be used after <span class="pre">match</span>.
	This expression's evaluated value is what patterns are matched with.
	If desired, an assignment expression can be used here to capture
	this matchee value for later use in matched code blocks.</li>
	<li>Any number of pattern blocks may follow. Each is comprised of a pattern
	followed by either a block or else a colon and a expression.
	If any pattern matches, the evaluated value of its block or expression is the match's value</li>
	<li>Using the <span class="pre">_</span> pattern will always match any value.
	If specified, it should be the last pattern used.</li>
	</ul>
	<p>A versatile range of patterns are supported, 
	able to match wholly to specified values, partially, or using a first-class pattern.
	Pattern matching also supports de-structuring portions of the original value
	into bound variables.</p>

	<h2>Whole Value Matches</h2>
	<p>The simplest form of value matching just uses a value as the pattern.
	This can be a constant value (as above) or any expression that evaluates to some value
	(e.g.: <span class="pre">anotherval.len</span>).
	The type of the pattern value must match the type of the matchee value.
	An equivalence match is performed between these values as if using the '==' operator.</p>
	<p>More complex value patterns are possible.</p>
	
	<h3>Comparisons</h3>
	<p>These patterns work just like any <a href="refcondexp.html#compop">comparison operator</a>
	(including <span class="pre">!=</span>).
	The left hand value is not specified, as it is understood to be the match value:</p>
<pre>
match n
  <0: -1
  >0:  1
  _:   0
</pre>

	<h3>Range pattern</h3>
	<p>The range pattern checks whether the matchee value lies within a specified
	range. This is specified by placing either the
	<span class="pre">..</span> or <span class="pre">...</span> range operator
	between two expressions:</p>
<pre>
match n
  0 ..  3: 1   // matches 0, 1, or 2 (but not 3)
  3 ... 6: 2   // matches 3, 4, 5 or 6 inclusively
</pre>
	
	<h2>Pattern Expressions</h2>
	<p>Before continuing on to talk about type-based pattern matching,
	let's introduce ways to enhance the match patterns already described
	as part of a more comprehensive pattern expression.</p>

	<h3>Multiple patterns</h3>
	<p>It is possible to list more than one possible pattern to match,
	using <span class="pre">or</span> between each pattern:</p>
<pre>
match n
  2 or 3 or 5 or 7:  2
  -6 or -1...1 or 6: 1
  _:                 0
</pre>
	
	<h3>Tuples</h3>
	<p>Multiple values to be matched can be specified on the
	<span class="pre">match</span> statement as a comma-separated tuple
	or with a function that returns multiple values.
	If a tuple is specified on the match, then all match patterns must be specified as tuples.
	For a tuple to match, all values must match individually:</p>
<pre>
match key,value
  0, _:  0
  _, 0:  1
  _, _:  2
</pre>

	<h3>if Guards</h3>
	<p>An 'if' clause may be specified following all patterns as an additional guard.
	The condition expression after the 'if' must evaluate to true in order for the
	match to take place.</p>
<pre>
match nbr
  4 if cnt &gt; 0: 0  // matches only if nbr==4 and cnt&gt;0
  4:            1  // matches when nbr==4 and cnt&lt;=0
  _:            2  // matches when nbr != 4
</pre>

	
	<h2>Partial matches</h2>
	<p>Partial matching is based on the idea that the matchee value is a composite data structure,
	and we only want to match on certain aspects to parts of that data.</p>
	<p>TBD. Match on certain substructural values.</p>
	<h3>Binding and Destructuring</h3>
	<p>TBD</p>
	<h3>Supertype Matching</h3>
	</p>TBD.</p>
	
	<h2>First-class patterns</h2>
	<p>For many match requirements, the above facilities are sufficient.
	However, there are times we need to use more sophisticated algorithms
	for making a match determination.
	These algorithms can be encapsulated in a callable function or method
	which returns true for a successful match.
	<p>Use of a first-class pattern is signaled using the <span class="pre">with</span> keyword.
	The matchee value is implicitly included as part of the call
	(as the first parameter for a function and the second for a method call):</p>
<pre>
match n
  with isPrime(): 0  // invokes isPrime(n)
  with isOdd():   1  // invokes isOdd(n)
  _:              2
</pre>
	<p>This technique makes it easier to use a broad range of complex
	pattern matching strategies, such as regular expressions, parsing, etc.
	The first-class pattern can be an object with state that changes as a result of
	a successful match. As part of the match, data can be extracted from the
	matchee value and preserved for later use by the match block.</p>
	
	<p><b>Note:</b> A first class pattern can be easily applied to any arbitrary value as part of
	an <span class="pre">if</span> statement:</p>
<pre>
++nbr if isOdd(n)
</pre>

	
	
	
		
		<p style="text-align: right; margin-top: 2em;">
			<a href="refloop.html"><img alt="_" src="next.png" /></a>
		</p>

	</div>
	</body>
</html>